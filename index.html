<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reportes SOS</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
</head>
<body>
    <h1>Plataforma de Reportes SOS</h1>
    
    <div id="auth">
        <button onclick="login()">Iniciar sesión con Google</button>
        <button onclick="logout()">Cerrar sesión</button>
    </div>
    
    <div id="report-section" style="display: none;">
        <h2>Enviar Reporte</h2>
        <input type="file" id="fileInput">
        <button onclick="sendReport()">Enviar</button>
        <p id="status"></p>
    </div>
    
    <script>
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_AUTH_DOMAIN",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_MESSAGING_SENDER_ID",
            appId: "TU_APP_ID"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('report-section').style.display = 'block';
            } else {
                document.getElementById('report-section').style.display = 'none';
            }
        });
        
        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider);
        }
        
        function logout() {
            auth.signOut();
        }
        
        async function sendReport() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) return alert("Selecciona un archivo");
            
            const storageRef = storage.ref('reports/' + file.name);
            await storageRef.put(file);
            const fileURL = await storageRef.getDownloadURL();
            
            navigator.geolocation.getCurrentPosition(async position => {
                await db.collection('reports').add({
                    user: auth.currentUser.email,
                    fileURL,
                    location: {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    },
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById('status').innerText = "Reporte enviado con éxito";
            });
        }
    </script>
</body>
</html>
